---
import { getCollection, type CollectionEntry } from "astro:content";
import ArticlePage from "../../components/ArticlePage.astro";
import { getSeriesNavigation } from "../../utils";

export async function getStaticPaths() {
    const posts = await getCollection("posts", ({ data }) => {
        return import.meta.env.PROD ? data.status !== "draft" : true;
    });

    return posts.map((post) => {
        const { prev, next } = getSeriesNavigation(posts, post);
        return {
            params: { slug: post.data.slug },
            props: { post, prevPost: prev, nextPost: next },
        };
    });
}

interface Props {
    post: CollectionEntry<"posts">;
    prevPost: CollectionEntry<"posts"> | null;
    nextPost: CollectionEntry<"posts"> | null;
}

const { post, prevPost, nextPost } = Astro.props;
---

<ArticlePage
    entry={post}
    prevEntry={prevPost}
    nextEntry={nextPost}
    urlPrefix="/posts"
/>
